$schema: https://azuremlschemas.azureedge.net/latest/pipelineJob.schema.json
type: pipeline
description: ML pipeline with training, promotion, and prediction
compute: azureml:transformer-load-compute

parameters:
  managed_identity_client_id: ""

jobs:

  train_job:
    type: command
    component: file:./train.yml
    environment_variables:
      MANAGED_IDENTITY_CLIENT_ID: ${{parent.parameters.managed_identity_client_id}}
    outputs:
      model_output: {type: uri_folder}

  promote_job:
    type: command
    component: file:./promote.yml
    inputs:
      model_input: ${{parent.jobs.train_job.outputs.model_output}}
    outputs:
      promoted_model: {type: uri_folder}

  predict_job:
    type: command
    component: file:./predict.yml
    environment_variables:
      MANAGED_IDENTITY_CLIENT_ID: ${{parent.parameters.managed_identity_client_id}}
    inputs:
      model_input: ${{parent.jobs.promote_job.outputs.promoted_model}}
